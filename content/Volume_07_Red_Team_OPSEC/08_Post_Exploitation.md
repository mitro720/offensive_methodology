# 08 - Post-Exploitation & Persistence

You have Domain/Enterprise Admin, or root access to critical infrastructure. Now, you need to ensure you don't lose access, extract the crown jewels, and operate undetected. (This is strictly Red Team / CNO territory, avoid destructive persistence in Bug Bounty / general pentests).

## 1. Active Directory Domination (The Crown Jewels)
- **Dumping the NTDS.dit:**
  - Extract the database containing ALL Active Directory password hashes for the entire domain.
  - Volume Shadow Copies (`vssadmin`) or `secretsdump.py`.
- **Golden Tickets:**
  - Extract the `krbtgt` account hash. You can now forge Kerberos Ticket Granting Tickets (TGTs) for *any user* (even non-existent ones) for *any service*, essentially securing indefinite domain dominance until the krbtgt password is reset twice.
- **Silver Tickets / Diamond Tickets:**
  - Forging Ticket Granting Service (TGS) tickets for specific services. Stealther than Golden Tickets.

## 2. Stealthy Persistence (Windows)
- **WMI Event Subscriptions:**
  - Execute payloads based on system events (e.g., when a specific user logs on, or when system uptime > 10 minutes). Fileless persistence.
- **Valid Accounts / Backdoored Users:**
  - Create a hidden local admin user or force a password reset on a disabled/service account.
- **Modify Security Descriptors (SDDL):**
  - Grant yourself DCSync rights to pull password hashes remotely without needing to be in the Domain Admins group.
- **Scheduled Tasks & Registry Run Keys:**
  - Classic but slightly noisy. Hide them under legitimate-looking task names (`WindowsUpdateCheck`).

## 3. Stealthy Persistence (Linux)
- **SSH Authorized Keys:**
  - Add your public key to `/root/.ssh/authorized_keys`.
- **PAM Backdoors:**
  - Modify Pluggable Authentication Modules to accept a master password for any user login.
- **Cron Jobs:**
  - Reverse shell callbacks or hidden listeners executing from highly privileged scripts.

## 4. Data Exfiltration
- **DNS Exfiltration:**
  - Encoding sensitive data in DNS query subdomains (`base64_data.attacker-domain.com`). Bypasses firewall blocks.
- **ICMP Exfiltration:**
  - Embedding data inside the payload of Ping packets.
- **Encrypted HTTP/HTTPS:**
  - Packing data and trickling it out via standard web traffic mimicking normal web browsing behavior.

## ðŸ’¡ Advanced Mindset Check
- *Never use your Domain Admin privileges to perform routine tasks.* If you own the domain, create a lower-privileged persistence route just for daily operations to avoid burning your highest level of access via SOC detection.
